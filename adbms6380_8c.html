<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.16.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>PER Firmware: source/a_box/adbms/adbms6380.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">PER Firmware
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.16.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a href="dir_b2f33c71d4aa5e7af42a1ca61ff5af1b.html">source</a></li><li class="navelem"><a href="dir_463a06e8c8df3dfb8722b56866f4fb0c.html">a_box</a></li><li class="navelem"><a href="dir_b9ac109653960c1c094259a09df46e85.html">adbms</a></li>  </ul>
</div>
</div><!-- top -->
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">adbms6380.c File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Low level BMS driver specific to ADBMS6380 chip.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="adbms6380_8h_source.html">adbms6380.h</a>&quot;</code><br />
<code>#include &lt;stdbool.h&gt;</code><br />
<code>#include &lt;stddef.h&gt;</code><br />
<code>#include &lt;stdint.h&gt;</code><br />
<code>#include &lt;string.h&gt;</code><br />
<code>#include &quot;<a class="el" href="commands_8h_source.html">commands.h</a>&quot;</code><br />
<code>#include &quot;common/freertos/freertos.h&quot;</code><br />
<code>#include &quot;common/phal/gpio.h&quot;</code><br />
<code>#include &quot;common/phal/spi.h&quot;</code><br />
<code>#include &quot;<a class="el" href="pec_8h_source.html">pec.h</a>&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-func-members" class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a12a7403f2f6b47af40cc7d278909ebe7" id="r_a12a7403f2f6b47af40cc7d278909ebe7"><td class="memItemLeft">void&#160;</td><td class="memItemRight"><a class="el" href="#a12a7403f2f6b47af40cc7d278909ebe7">adbms6380_set_cs_low</a> (<a class="el" href="structSPI__InitConfig__t.html">SPI_InitConfig_t</a> *spi)</td></tr>
<tr class="memdesc:a12a7403f2f6b47af40cc7d278909ebe7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Drive the ADBMS CS line low.  <br /></td></tr>
<tr class="memitem:ae50a5200f4ab61124ab070e8898f0cc9" id="r_ae50a5200f4ab61124ab070e8898f0cc9"><td class="memItemLeft">void&#160;</td><td class="memItemRight"><a class="el" href="#ae50a5200f4ab61124ab070e8898f0cc9">adbms6380_set_cs_high</a> (<a class="el" href="structSPI__InitConfig__t.html">SPI_InitConfig_t</a> *spi)</td></tr>
<tr class="memdesc:ae50a5200f4ab61124ab070e8898f0cc9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Drive the ADBMS CS line to high.  <br /></td></tr>
<tr class="memitem:a98d7e305df1794e6146e9aa0e885bf65" id="r_a98d7e305df1794e6146e9aa0e885bf65"><td class="memItemLeft">void&#160;</td><td class="memItemRight"><a class="el" href="#a98d7e305df1794e6146e9aa0e885bf65">adbms6380_wake</a> (<a class="el" href="structSPI__InitConfig__t.html">SPI_InitConfig_t</a> *spi, size_t module_count)</td></tr>
<tr class="memdesc:a98d7e305df1794e6146e9aa0e885bf65"><td class="mdescLeft">&#160;</td><td class="mdescRight">Wake a daisy-chained set of ADBMS devices.  <br /></td></tr>
<tr class="memitem:a7dba9c62715355f360c6e4f1b150d334" id="r_a7dba9c62715355f360c6e4f1b150d334"><td class="memItemLeft">uint16_t&#160;</td><td class="memItemRight"><a class="el" href="#a7dba9c62715355f360c6e4f1b150d334">adbms6380_get_threshold_voltage_cfg</a> (float threshold_voltage)</td></tr>
<tr class="memdesc:a7dba9c62715355f360c6e4f1b150d334"><td class="mdescLeft">&#160;</td><td class="mdescRight">Convert a voltage threshold (V) into 12-bit REG_B threshold encoding.  <br /></td></tr>
<tr class="memitem:a5015be743738347dcf5a108a0fd276d6" id="r_a5015be743738347dcf5a108a0fd276d6"><td class="memItemLeft">int16_t&#160;</td><td class="memItemRight"><a class="el" href="#a5015be743738347dcf5a108a0fd276d6">adbms6380_extract_i16</a> (uint8_t *data, int idx)</td></tr>
<tr class="memdesc:a5015be743738347dcf5a108a0fd276d6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Extract a little-endian 16-bit signed value from a byte buffer.  <br /></td></tr>
<tr class="memitem:a2e9f567aae9798e09e92280c8919a184" id="r_a2e9f567aae9798e09e92280c8919a184"><td class="memItemLeft">float&#160;</td><td class="memItemRight"><a class="el" href="#a2e9f567aae9798e09e92280c8919a184">adbms6380_raw_to_v</a> (int16_t raw)</td></tr>
<tr class="memdesc:a2e9f567aae9798e09e92280c8919a184"><td class="mdescLeft">&#160;</td><td class="mdescRight">Convert raw voltage measurement from the ADBMS6380 to volts.  <br /></td></tr>
<tr class="memitem:aa5e12ae30b128ce06afa0c0dfc19e2ac" id="r_aa5e12ae30b128ce06afa0c0dfc19e2ac"><td class="memItemLeft">void&#160;</td><td class="memItemRight"><a class="el" href="#aa5e12ae30b128ce06afa0c0dfc19e2ac">adbms6380_adcv</a> (uint8_t output_cmd[<a class="el" href="adbms6380_8h.html#abb0d4748227668be895e371af4b96454">ADBMS6380_COMMAND_RAW_SIZE</a>], bool rd, bool cont, bool dcp, bool rstf, uint8_t ow)</td></tr>
<tr class="memitem:a9849bfe4b93c2a5ce93af04ff58d79d5" id="r_a9849bfe4b93c2a5ce93af04ff58d79d5"><td class="memItemLeft">void&#160;</td><td class="memItemRight"><a class="el" href="#a9849bfe4b93c2a5ce93af04ff58d79d5">adbms6380_adsv</a> (uint8_t output_cmd[<a class="el" href="adbms6380_8h.html#abb0d4748227668be895e371af4b96454">ADBMS6380_COMMAND_RAW_SIZE</a>], bool cont, bool dcp, uint8_t ow)</td></tr>
<tr class="memitem:a810f35acf333d387896a733e2987cadd" id="r_a810f35acf333d387896a733e2987cadd"><td class="memItemLeft">void&#160;</td><td class="memItemRight"><a class="el" href="#a810f35acf333d387896a733e2987cadd">adbms6380_adax</a> (uint8_t output_cmd[<a class="el" href="adbms6380_8h.html#abb0d4748227668be895e371af4b96454">ADBMS6380_COMMAND_RAW_SIZE</a>], bool ow, bool pup, uint8_t ch)</td></tr>
<tr class="memdesc:a810f35acf333d387896a733e2987cadd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Build ADAX (aux) command bytes.  <br /></td></tr>
<tr class="memitem:a87779ad64f4a74f4550870855d30d4a2" id="r_a87779ad64f4a74f4550870855d30d4a2"><td class="memItemLeft">void&#160;</td><td class="memItemRight"><a class="el" href="#a87779ad64f4a74f4550870855d30d4a2">adbms6380_prepare_command</a> (strbuf_t *output_buffer, const uint8_t command[<a class="el" href="adbms6380_8h.html#abb0d4748227668be895e371af4b96454">ADBMS6380_COMMAND_RAW_SIZE</a>])</td></tr>
<tr class="memdesc:a87779ad64f4a74f4550870855d30d4a2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Append a command and its PEC to an output buffer.  <br /></td></tr>
<tr class="memitem:a8c34ef8839dcd0f491ade5e2f7146e9b" id="r_a8c34ef8839dcd0f491ade5e2f7146e9b"><td class="memItemLeft">void&#160;</td><td class="memItemRight"><a class="el" href="#a8c34ef8839dcd0f491ade5e2f7146e9b">adbms6380_prepare_data_packet</a> (strbuf_t *output_buffer, const uint8_t data[<a class="el" href="adbms6380_8h.html#a05594a85d957953e99e26e8e75d9c9d7">ADBMS6380_SINGLE_DATA_RAW_SIZE</a>])</td></tr>
<tr class="memdesc:a8c34ef8839dcd0f491ade5e2f7146e9b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Append a data payload and its PEC to an output buffer.  <br /></td></tr>
<tr class="memitem:ad6309659e70a91acde06af856a1ff7c3" id="r_ad6309659e70a91acde06af856a1ff7c3"><td class="memItemLeft">void&#160;</td><td class="memItemRight"><a class="el" href="#ad6309659e70a91acde06af856a1ff7c3">adbms6380_calculate_cfg_rega</a> (uint8_t output_cfg_rega[<a class="el" href="adbms6380_8h.html#a05594a85d957953e99e26e8e75d9c9d7">ADBMS6380_SINGLE_DATA_RAW_SIZE</a>], bool refon, uint8_t cth)</td></tr>
<tr class="memdesc:ad6309659e70a91acde06af856a1ff7c3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculate the REG_A configuration register value.  <br /></td></tr>
<tr class="memitem:a7edc17528da09597a1ba5cd6d5e9671e" id="r_a7edc17528da09597a1ba5cd6d5e9671e"><td class="memItemLeft">void&#160;</td><td class="memItemRight"><a class="el" href="#a7edc17528da09597a1ba5cd6d5e9671e">adbms6380_calculate_cfg_regb</a> (uint8_t output_cfg_regb[<a class="el" href="adbms6380_8h.html#a05594a85d957953e99e26e8e75d9c9d7">ADBMS6380_SINGLE_DATA_RAW_SIZE</a>], float overvoltage_threshold, float undervoltage_threshold, const bool is_discharging[<a class="el" href="adbms6380_8h.html#a9e8247a946b3c04fac7b53fe6ac5649b">ADBMS6380_CELL_COUNT</a>])</td></tr>
<tr class="memdesc:a7edc17528da09597a1ba5cd6d5e9671e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculate the REG_B configuration register value.  <br /></td></tr>
<tr class="memitem:a4ac224a3bfc80249e11dd1614d8b06bb" id="r_a4ac224a3bfc80249e11dd1614d8b06bb"><td class="memItemLeft">bool&#160;</td><td class="memItemRight"><a class="el" href="#a4ac224a3bfc80249e11dd1614d8b06bb">adbms6380_read_data</a> (<a class="el" href="structSPI__InitConfig__t.html">SPI_InitConfig_t</a> *spi, size_t module_count, const uint8_t cmd_buffer[<a class="el" href="adbms6380_8h.html#ab8248c41f0c4b71fea53867726fa3b87">ADBMS6380_COMMAND_PKT_SIZE</a>], uint8_t *<a class="el" href="test__buffer_8c.html#a915a1f4b2627f8c3dcf303da38c1ebd4">rx_buffer</a>)</td></tr>
<tr class="memdesc:a4ac224a3bfc80249e11dd1614d8b06bb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Read a single-data-packet response per module.  <br /></td></tr>
<tr class="memitem:ab30c0136c1a1a9025b04b820ab68a097" id="r_ab30c0136c1a1a9025b04b820ab68a097"><td class="memItemLeft">bool&#160;</td><td class="memItemRight"><a class="el" href="#ab30c0136c1a1a9025b04b820ab68a097">adbms6380_read</a> (<a class="el" href="structSPI__InitConfig__t.html">SPI_InitConfig_t</a> *spi, size_t module_count, const uint8_t cmd_buffer[<a class="el" href="adbms6380_8h.html#ab8248c41f0c4b71fea53867726fa3b87">ADBMS6380_COMMAND_PKT_SIZE</a>], uint8_t *<a class="el" href="test__buffer_8c.html#a915a1f4b2627f8c3dcf303da38c1ebd4">rx_buffer</a>, size_t rx_length)</td></tr>
<tr class="memdesc:ab30c0136c1a1a9025b04b820ab68a097"><td class="mdescLeft">&#160;</td><td class="mdescRight">Read a fixed-length response from all modules after a command.  <br /></td></tr>
<tr class="memitem:a38be58f4cc5cc9b3c0cfd9cfa4feba90" id="r_a38be58f4cc5cc9b3c0cfd9cfa4feba90"><td class="memItemLeft">bool&#160;</td><td class="memItemRight"><a class="el" href="#a38be58f4cc5cc9b3c0cfd9cfa4feba90">adbms6380_read_cell_voltages</a> (<a class="el" href="structSPI__InitConfig__t.html">SPI_InitConfig_t</a> *spi, strbuf_t *cmd_buffer, uint8_t *<a class="el" href="test__buffer_8c.html#a915a1f4b2627f8c3dcf303da38c1ebd4">rx_buffer</a>, float **cell_voltages, int16_t **cell_voltages_raw, size_t module_count)</td></tr>
<tr class="memdesc:a38be58f4cc5cc9b3c0cfd9cfa4feba90"><td class="mdescLeft">&#160;</td><td class="mdescRight">Read all cell voltages from each module.  <br /></td></tr>
<tr class="memitem:a17d1d330c36b5b73b328d8376cdc4a1a" id="r_a17d1d330c36b5b73b328d8376cdc4a1a"><td class="memItemLeft">bool&#160;</td><td class="memItemRight"><a class="el" href="#a17d1d330c36b5b73b328d8376cdc4a1a">adbms6380_read_gpio_voltages</a> (<a class="el" href="structSPI__InitConfig__t.html">SPI_InitConfig_t</a> *spi, strbuf_t *cmd_buffer, uint8_t *<a class="el" href="test__buffer_8c.html#a915a1f4b2627f8c3dcf303da38c1ebd4">rx_buffer</a>, float **gpio_voltages, size_t module_count)</td></tr>
<tr class="memdesc:a17d1d330c36b5b73b328d8376cdc4a1a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Read all GPIO/aux voltages from each module.  <br /></td></tr>
</table>
<a name="details" id="details"></a><h2 id="header-details" class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Low level BMS driver specific to ADBMS6380 chip. </p>
<dl class="section author"><dt>Author</dt><dd>Millan Kumar (<a href="#" onclick="location.href='mai'+'lto:'+'kum'+'ar'+'798'+'@p'+'urd'+'ue'+'.ed'+'u'; return false;">kumar<span class="obfuscator">.nosp@m.</span>798@<span class="obfuscator">.nosp@m.</span>purdu<span class="obfuscator">.nosp@m.</span>e.ed<span class="obfuscator">.nosp@m.</span>u</a>) </dd></dl>
</div><a name="doc-func-members" id="doc-func-members"></a><h2 id="header-doc-func-members" class="groupheader">Function Documentation</h2>
<a id="a810f35acf333d387896a733e2987cadd" name="a810f35acf333d387896a733e2987cadd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a810f35acf333d387896a733e2987cadd">&#9670;&#160;</a></span>adbms6380_adax()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void adbms6380_adax </td>
          <td>(</td>
          <td class="paramtype">uint8_t</td>          <td class="paramname"><span class="paramname"><em>output_cmd</em></span>[ADBMS6380_COMMAND_RAW_SIZE], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool</td>          <td class="paramname"><span class="paramname"><em>ow</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool</td>          <td class="paramname"><span class="paramname"><em>pup</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t</td>          <td class="paramname"><span class="paramname"><em>ch</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Build ADAX (aux) command bytes. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">output_cmd</td><td>Output buffer for 2-byte command. </td></tr>
    <tr><td class="paramname">ow</td><td>Open-wire detection enable. </td></tr>
    <tr><td class="paramname">pup</td><td>Pull-up enable for open-wire detection. </td></tr>
    <tr><td class="paramname">ch</td><td>Channel selection (5-bit). 0 for all. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="aa5e12ae30b128ce06afa0c0dfc19e2ac" name="aa5e12ae30b128ce06afa0c0dfc19e2ac"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa5e12ae30b128ce06afa0c0dfc19e2ac">&#9670;&#160;</a></span>adbms6380_adcv()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void adbms6380_adcv </td>
          <td>(</td>
          <td class="paramtype">uint8_t</td>          <td class="paramname"><span class="paramname"><em>output_cmd</em></span>[ADBMS6380_COMMAND_RAW_SIZE], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool</td>          <td class="paramname"><span class="paramname"><em>rd</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool</td>          <td class="paramname"><span class="paramname"><em>cont</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool</td>          <td class="paramname"><span class="paramname"><em>dcp</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool</td>          <td class="paramname"><span class="paramname"><em>rstf</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t</td>          <td class="paramname"><span class="paramname"><em>ow</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a9849bfe4b93c2a5ce93af04ff58d79d5" name="a9849bfe4b93c2a5ce93af04ff58d79d5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9849bfe4b93c2a5ce93af04ff58d79d5">&#9670;&#160;</a></span>adbms6380_adsv()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void adbms6380_adsv </td>
          <td>(</td>
          <td class="paramtype">uint8_t</td>          <td class="paramname"><span class="paramname"><em>output_cmd</em></span>[ADBMS6380_COMMAND_RAW_SIZE], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool</td>          <td class="paramname"><span class="paramname"><em>cont</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool</td>          <td class="paramname"><span class="paramname"><em>dcp</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t</td>          <td class="paramname"><span class="paramname"><em>ow</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ad6309659e70a91acde06af856a1ff7c3" name="ad6309659e70a91acde06af856a1ff7c3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad6309659e70a91acde06af856a1ff7c3">&#9670;&#160;</a></span>adbms6380_calculate_cfg_rega()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void adbms6380_calculate_cfg_rega </td>
          <td>(</td>
          <td class="paramtype">uint8_t</td>          <td class="paramname"><span class="paramname"><em>output_cfg_rega</em></span>[ADBMS6380_SINGLE_DATA_RAW_SIZE], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool</td>          <td class="paramname"><span class="paramname"><em>refon</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t</td>          <td class="paramname"><span class="paramname"><em>cth</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Calculate the REG_A configuration register value. </p>
<p>Populates GPIO pull-downs, reference behavior, and comparator threshold.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">output_cfg_rega</td><td>Output buffer for REG_A configuration (6 bytes). </td></tr>
    <tr><td class="paramname">refon</td><td>1 = reference remains powered up until watchdog timeout. </td></tr>
    <tr><td class="paramname">cth</td><td>C-ADC vs. S-ADC comparison voltage threshold. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a7edc17528da09597a1ba5cd6d5e9671e" name="a7edc17528da09597a1ba5cd6d5e9671e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7edc17528da09597a1ba5cd6d5e9671e">&#9670;&#160;</a></span>adbms6380_calculate_cfg_regb()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void adbms6380_calculate_cfg_regb </td>
          <td>(</td>
          <td class="paramtype">uint8_t</td>          <td class="paramname"><span class="paramname"><em>output_cfg_regb</em></span>[ADBMS6380_SINGLE_DATA_RAW_SIZE], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float</td>          <td class="paramname"><span class="paramname"><em>overvoltage_threshold</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float</td>          <td class="paramname"><span class="paramname"><em>undervoltage_threshold</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool</td>          <td class="paramname"><span class="paramname"><em>is_discharging</em></span>[ADBMS6380_CELL_COUNT]&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Calculate the REG_B configuration register value. </p>
<p>Encodes VOV/VUV thresholds and discharge control bits.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">output_cfg_regb</td><td>Output buffer for REG_B configuration (6 bytes). </td></tr>
    <tr><td class="paramname">overvoltage_threshold</td><td>Overvoltage threshold in volts. </td></tr>
    <tr><td class="paramname">undervoltage_threshold</td><td>Undervoltage threshold in volts. </td></tr>
    <tr><td class="paramname">is_discharging</td><td>Per-cell discharge enable flags. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a5015be743738347dcf5a108a0fd276d6" name="a5015be743738347dcf5a108a0fd276d6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5015be743738347dcf5a108a0fd276d6">&#9670;&#160;</a></span>adbms6380_extract_i16()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int16_t adbms6380_extract_i16 </td>
          <td>(</td>
          <td class="paramtype">uint8_t *</td>          <td class="paramname"><span class="paramname"><em>data</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>idx</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Extract a little-endian 16-bit signed value from a byte buffer. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">data</td><td>Pointer to byte buffer containing 16-bit words. </td></tr>
    <tr><td class="paramname">idx</td><td>Index of the 16-bit word to extract. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Signed 16-bit value. </dd></dl>

</div>
</div>
<a id="a7dba9c62715355f360c6e4f1b150d334" name="a7dba9c62715355f360c6e4f1b150d334"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7dba9c62715355f360c6e4f1b150d334">&#9670;&#160;</a></span>adbms6380_get_threshold_voltage_cfg()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint16_t adbms6380_get_threshold_voltage_cfg </td>
          <td>(</td>
          <td class="paramtype">float</td>          <td class="paramname"><span class="paramname"><em>threshold_voltage</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Convert a voltage threshold (V) into 12-bit REG_B threshold encoding. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">threshold_voltage</td><td>Threshold voltage in volts. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>12-bit configuration value suitable for VOV/VUV fields. </dd></dl>

</div>
</div>
<a id="a87779ad64f4a74f4550870855d30d4a2" name="a87779ad64f4a74f4550870855d30d4a2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a87779ad64f4a74f4550870855d30d4a2">&#9670;&#160;</a></span>adbms6380_prepare_command()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void adbms6380_prepare_command </td>
          <td>(</td>
          <td class="paramtype">strbuf_t *</td>          <td class="paramname"><span class="paramname"><em>output_buffer</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint8_t</td>          <td class="paramname"><span class="paramname"><em>command</em></span>[ADBMS6380_COMMAND_RAW_SIZE]&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Append a command and its PEC to an output buffer. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">output_buffer</td><td>Buffer to append into. </td></tr>
    <tr><td class="paramname">command</td><td>2-byte command payload. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a8c34ef8839dcd0f491ade5e2f7146e9b" name="a8c34ef8839dcd0f491ade5e2f7146e9b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8c34ef8839dcd0f491ade5e2f7146e9b">&#9670;&#160;</a></span>adbms6380_prepare_data_packet()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void adbms6380_prepare_data_packet </td>
          <td>(</td>
          <td class="paramtype">strbuf_t *</td>          <td class="paramname"><span class="paramname"><em>output_buffer</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint8_t</td>          <td class="paramname"><span class="paramname"><em>data</em></span>[ADBMS6380_SINGLE_DATA_RAW_SIZE]&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Append a data payload and its PEC to an output buffer. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">output_buffer</td><td>Buffer to append into. </td></tr>
    <tr><td class="paramname">data</td><td>6-byte data payload. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a2e9f567aae9798e09e92280c8919a184" name="a2e9f567aae9798e09e92280c8919a184"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2e9f567aae9798e09e92280c8919a184">&#9670;&#160;</a></span>adbms6380_raw_to_v()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float adbms6380_raw_to_v </td>
          <td>(</td>
          <td class="paramtype">int16_t</td>          <td class="paramname"><span class="paramname"><em>raw</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Convert raw voltage measurement from the ADBMS6380 to volts. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">raw</td><td>Raw code from ADBMS. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Corresponding voltage in volts. </dd></dl>

</div>
</div>
<a id="ab30c0136c1a1a9025b04b820ab68a097" name="ab30c0136c1a1a9025b04b820ab68a097"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab30c0136c1a1a9025b04b820ab68a097">&#9670;&#160;</a></span>adbms6380_read()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool adbms6380_read </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structSPI__InitConfig__t.html">SPI_InitConfig_t</a> *</td>          <td class="paramname"><span class="paramname"><em>spi</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t</td>          <td class="paramname"><span class="paramname"><em>module_count</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint8_t</td>          <td class="paramname"><span class="paramname"><em>cmd_buffer</em></span>[ADBMS6380_COMMAND_PKT_SIZE], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *</td>          <td class="paramname"><span class="paramname"><em>rx_buffer</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t</td>          <td class="paramname"><span class="paramname"><em>rx_length</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Read a fixed-length response from all modules after a command. </p>
<p>Sends the command to the daisy chain, then reads <code class="param">rx_length</code> bytes into <code class="param">rx_buffer</code>. Data is returned in module order (0..N-1).</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">spi</td><td>SPI configuration used for the transfer. </td></tr>
    <tr><td class="paramname">module_count</td><td>Number of modules in the daisy chain. </td></tr>
    <tr><td class="paramname">cmd_buffer</td><td>Command buffer including PEC. </td></tr>
    <tr><td class="paramname"><a class="el" href="test__buffer_8c.html#a915a1f4b2627f8c3dcf303da38c1ebd4">rx_buffer</a></td><td>Output buffer for received bytes. </td></tr>
    <tr><td class="paramname">rx_length</td><td>Total number of bytes to read. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>True on successful SPI transfers, false otherwise. </dd></dl>

</div>
</div>
<a id="a38be58f4cc5cc9b3c0cfd9cfa4feba90" name="a38be58f4cc5cc9b3c0cfd9cfa4feba90"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a38be58f4cc5cc9b3c0cfd9cfa4feba90">&#9670;&#160;</a></span>adbms6380_read_cell_voltages()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool adbms6380_read_cell_voltages </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structSPI__InitConfig__t.html">SPI_InitConfig_t</a> *</td>          <td class="paramname"><span class="paramname"><em>spi</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">strbuf_t *</td>          <td class="paramname"><span class="paramname"><em>cmd_buffer</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *</td>          <td class="paramname"><span class="paramname"><em>rx_buffer</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float **</td>          <td class="paramname"><span class="paramname"><em>cell_voltages</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int16_t **</td>          <td class="paramname"><span class="paramname"><em>cell_voltages_raw</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t</td>          <td class="paramname"><span class="paramname"><em>module_count</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Read all cell voltages from each module. </p>
<p>Issues the RDCVALL command, converts raw values to volts, and fills the provided per-module cell voltage arrays.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">spi</td><td>SPI configuration used for the transfer. </td></tr>
    <tr><td class="paramname">cmd_buffer</td><td>Scratch buffer for command + PEC. </td></tr>
    <tr><td class="paramname"><a class="el" href="test__buffer_8c.html#a915a1f4b2627f8c3dcf303da38c1ebd4">rx_buffer</a></td><td>RX buffer for raw bytes. </td></tr>
    <tr><td class="paramname">cell_voltages</td><td>Per-module arrays of cell voltages to populate. </td></tr>
    <tr><td class="paramname">cell_voltages_raw</td><td>Per-module arrays of raw cell voltage codes to populate. </td></tr>
    <tr><td class="paramname">module_count</td><td>Number of modules in the daisy chain. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>True on success, false on SPI failure. </dd></dl>

</div>
</div>
<a id="a4ac224a3bfc80249e11dd1614d8b06bb" name="a4ac224a3bfc80249e11dd1614d8b06bb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4ac224a3bfc80249e11dd1614d8b06bb">&#9670;&#160;</a></span>adbms6380_read_data()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool adbms6380_read_data </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structSPI__InitConfig__t.html">SPI_InitConfig_t</a> *</td>          <td class="paramname"><span class="paramname"><em>spi</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t</td>          <td class="paramname"><span class="paramname"><em>module_count</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint8_t</td>          <td class="paramname"><span class="paramname"><em>cmd_buffer</em></span>[ADBMS6380_COMMAND_PKT_SIZE], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *</td>          <td class="paramname"><span class="paramname"><em>rx_buffer</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Read a single-data-packet response per module. </p>
<p>Convenience wrapper around <a class="el" href="adbms6380_8h.html#ab30c0136c1a1a9025b04b820ab68a097" title="Read a fixed-length response from all modules after a command.">adbms6380_read()</a> with (module_count * ADBMS6380_SINGLE_DATA_PKT_SIZE) bytes.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">spi</td><td>SPI configuration used for the transfer. </td></tr>
    <tr><td class="paramname">module_count</td><td>Number of modules in the daisy chain. </td></tr>
    <tr><td class="paramname">cmd_buffer</td><td>Command buffer including PEC. </td></tr>
    <tr><td class="paramname"><a class="el" href="test__buffer_8c.html#a915a1f4b2627f8c3dcf303da38c1ebd4">rx_buffer</a></td><td>Output buffer for received bytes. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>True on successful SPI transfers, false otherwise. </dd></dl>

</div>
</div>
<a id="a17d1d330c36b5b73b328d8376cdc4a1a" name="a17d1d330c36b5b73b328d8376cdc4a1a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a17d1d330c36b5b73b328d8376cdc4a1a">&#9670;&#160;</a></span>adbms6380_read_gpio_voltages()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool adbms6380_read_gpio_voltages </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structSPI__InitConfig__t.html">SPI_InitConfig_t</a> *</td>          <td class="paramname"><span class="paramname"><em>spi</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">strbuf_t *</td>          <td class="paramname"><span class="paramname"><em>cmd_buffer</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *</td>          <td class="paramname"><span class="paramname"><em>rx_buffer</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float **</td>          <td class="paramname"><span class="paramname"><em>gpio_voltages</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t</td>          <td class="paramname"><span class="paramname"><em>module_count</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Read all GPIO/aux voltages from each module. </p>
<p>Issues RDAUXA/B/C/D commands, converts raw values to volts, and fills the provided per-module GPIO voltage arrays.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">spi</td><td>SPI configuration used for the transfer. </td></tr>
    <tr><td class="paramname">cmd_buffer</td><td>Scratch buffer for command + PEC. </td></tr>
    <tr><td class="paramname"><a class="el" href="test__buffer_8c.html#a915a1f4b2627f8c3dcf303da38c1ebd4">rx_buffer</a></td><td>RX buffer for raw bytes. </td></tr>
    <tr><td class="paramname">gpio_voltages</td><td>Per-module arrays of GPIO voltages to populate. </td></tr>
    <tr><td class="paramname">module_count</td><td>Number of modules in the daisy chain. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>True on success, false on SPI failure. </dd></dl>

</div>
</div>
<a id="ae50a5200f4ab61124ab070e8898f0cc9" name="ae50a5200f4ab61124ab070e8898f0cc9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae50a5200f4ab61124ab070e8898f0cc9">&#9670;&#160;</a></span>adbms6380_set_cs_high()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void adbms6380_set_cs_high </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structSPI__InitConfig__t.html">SPI_InitConfig_t</a> *</td>          <td class="paramname"><span class="paramname"><em>spi</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Drive the ADBMS CS line to high. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">spi</td><td>SPI configuration containing the CS GPIO. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a12a7403f2f6b47af40cc7d278909ebe7" name="a12a7403f2f6b47af40cc7d278909ebe7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a12a7403f2f6b47af40cc7d278909ebe7">&#9670;&#160;</a></span>adbms6380_set_cs_low()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void adbms6380_set_cs_low </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structSPI__InitConfig__t.html">SPI_InitConfig_t</a> *</td>          <td class="paramname"><span class="paramname"><em>spi</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Drive the ADBMS CS line low. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">spi</td><td>SPI configuration containing the CS GPIO. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a98d7e305df1794e6146e9aa0e885bf65" name="a98d7e305df1794e6146e9aa0e885bf65"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a98d7e305df1794e6146e9aa0e885bf65">&#9670;&#160;</a></span>adbms6380_wake()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void adbms6380_wake </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structSPI__InitConfig__t.html">SPI_InitConfig_t</a> *</td>          <td class="paramname"><span class="paramname"><em>spi</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t</td>          <td class="paramname"><span class="paramname"><em>module_count</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Wake a daisy-chained set of ADBMS devices. </p>
<p>Toggles CS with blocking delays to bring each module out of sleep.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">spi</td><td>SPI configuration containing the CS GPIO. </td></tr>
    <tr><td class="paramname">module_count</td><td>Number of modules in the daisy chain. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.16.1
</small></address>
</div><!-- doc-content -->
</body>
</html>
